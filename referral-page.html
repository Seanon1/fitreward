<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refer a Friend - Fitbonus</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons (e.g., copy icon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Base body and font styles */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Navigation specific styles */
        #menu-toggle {
            display: none;
        }

        #menu-toggle:checked+label+div#menu-links {
            display: flex;
        }

        .nav-link-active {
            border-bottom-width: 2px;
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }

        .hero-bg {
            background-image: linear-gradient(to right, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.9));
        }

        /* Custom styles for referral page elements */
        .referral-card {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 36rem;
            /* max-w-md is 28rem, max-w-lg is 32rem, max-w-xl is 36rem */
        }

        .referral-link-input {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            color: #4b5563;
            cursor: text;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .copy-button {
            background-color: #8b5cf6;
            /* Purple */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3);
        }

        .copy-button:hover {
            background-color: #7c3aed;
        }

        .copy-button:active {
            transform: translateY(1px);
        }

        .submit-button {
            background-color: #3b82f6;
            /* Blue */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }

        .submit-button:hover {
            background-color: #2563eb;
        }

        .submit-button:active {
            transform: translateY(1px);
        }

        .message-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
            text-align: center;
        }

        .message-box.success {
            background-color: #d1fae5;
            /* Green-100 */
            color: #065f46;
            /* Green-800 */
        }

        .message-box.error {
            background-color: #fee2e2;
            /* Red-100 */
            color: #991b1b;
            /* Red-800 */
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-gray-100 text-gray-800">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md sticky top-0 w-full z-20">
        <div class="container mx-auto px-6 flex justify-between items-center flex-wrap">
            <a href="index.html" class="flex items-center mb-4 sm:mb-0 space-x-3 rtl:space-x-reverse">
                <span class="self-center text-2xl font-semibold whitespace-nowrap text-light text-purple-500">Fitbonus
                </span>
            </a>
            <input type="checkbox" id="menu-toggle" class="peer">

            <label for="menu-toggle" class="md:hidden cursor-pointer p-2 rounded-md hover:bg-gray-100">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </label>
            <div id="menu-links" class="hidden w-full bg-white shadow-md py-2 flex-col
                        md:static md:flex md:w-auto md:shadow-none md:bg-transparent md:py-0
                        md:flex-row md:items-center md:space-x-4">
                <a href="index.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">Home</a>
                <a href="about.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">About</a>
                <a href="referral-page.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">Referrals
                    </a>
                <a href="leaderboard.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">Leaderboard
                </a>
                <a href="bmi.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">Bmi
                    Calculator
                </a>
                <a href="login.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link">Login
                </a>
                <a href="journal.html"
                    class="block w-full text-center md:w-auto text-light text-purple-500 hover:text-blue-600 px-3 py-3 md:py-2 rounded-md text-sm font-medium nav-link nav-link-active">Journal
                </a>
        </div>
    </nav>

    <!-- Main Content Area for Referral Page -->
    <main class="flex-grow container mx-auto px-6 py-12 flex flex-col items-center justify-start">
        <div class="referral-card text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-600 mb-4">Refer a Friend, Get Fit, Get Rewards!</h1>
            <p class="text-gray-600 mb-6">Share the joy of fitness with your friends and earn exciting bonuses for
                every successful referral. The more you refer, the more you earn!</p>

            <div class="mb-8">
                <h2 class="text-xl font-semibold text-purple-700 mb-3">Your Unique Referral Link</h2>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <input type="text" id="referralLink" readonly
                        class="referral-link-input flex-grow text-center sm:text-left">
                    <button id="copyLinkBtn" class="copy-button flex items-center justify-center gap-2 w-full sm:w-auto">
                        <i class="fas fa-copy"></i> Copy Link
                    </button>
                </div>
                <div id="copyMessage" class="text-green-600 text-sm mt-2 hidden">Link copied to clipboard!</div>
            </div>

            <div class="mb-8">
                <h2 class="text-xl font-semibold text-purple-700 mb-3">Refer a Friend Now!</h2>
                <form id="referralForm" class="space-y-4">
                    <div>
                        <label for="referrerName" class="block text-gray-700 text-sm font-bold mb-2 text-left">Your
                            Name:</label>
                        <input type="text" id="referrerName"
                            class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="e.g., Jane Doe" required>
                    </div>
                    <div>
                        <label for="friendEmail"
                            class="block text-gray-700 text-sm font-bold mb-2 text-left">Friend's Email:</label>
                        <input type="email" id="friendEmail"
                            class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="friend@example.com" required>
                    </div>
                    <button type="submit" class="submit-button w-full">Send Referral</button>
                    <div id="formMessage" class="message-box hidden"></div>
                </form>
            </div>

            <div>
                <h2 class="text-xl font-semibold text-purple-700 mb-3">Your Sent Referrals</h2>
                <div id="referralsListContainer" class="bg-gray-50 p-4 rounded-md shadow-inner max-h-60 overflow-y-auto">
                    <ul id="sentReferralsList" class="list-disc list-inside text-left text-gray-700">
                        <!-- Referrals will be dynamically loaded here -->
                        <li class="text-gray-500">No referrals sent yet. Start sharing!</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center p-4 mt-auto w-full">
        &copy; 2025 Fitbonus. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const referralLinkInput = document.getElementById('referralLink');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const copyMessage = document.getElementById('copyMessage');
            const referralForm = document.getElementById('referralForm');
            const referrerNameInput = document.getElementById('referrerName');
            const friendEmailInput = document.getElementById('friendEmail');
            const formMessage = document.getElementById('formMessage');
            const sentReferralsList = document.getElementById('sentReferralsList');

            // --- Simulated User ID and Data Storage ---
            // In a real application, userId would come from authentication,
            // and referrals would be stored in a database (e.g., Firestore).
            // For this demo, we use localStorage to persist data in the browser.
            let userId = localStorage.getItem('fitbonusUserId');
            if (!userId) {
                // Generate a simple unique ID if not found
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('fitbonusUserId', userId);
            }

            let userReferrals = JSON.parse(localStorage.getItem('fitbonusReferrals')) || [];

            // --- Functions ---

            /**
             * Generates a unique referral link for the current user.
             * In a real app, this might involve a backend API call.
             */
            function generateReferralLink() {
                // Example: current URL + ?ref=USER_ID
                const baseUrl = window.location.origin + window.location.pathname;
                return `${baseUrl}?ref=${userId}`;
            }

            /**
             * Copies text to the clipboard.
             * Uses document.execCommand('copy') for broader compatibility in iframes.
             */
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    displayMessage(copyMessage, 'Link copied to clipboard!', 'success');
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    displayMessage(copyMessage, 'Failed to copy link. Please copy manually.', 'error');
                }
                document.body.removeChild(textarea);
            }

            /**
             * Displays a temporary message in a given element.
             * @param {HTMLElement} element - The DOM element to display the message in.
             * @param {string} message - The message text.
             * @param {string} type - 'success' or 'error' for styling.
             */
            function displayMessage(element, message, type) {
                element.textContent = message;
                element.className = `message-box ${type}`; // Apply base and type-specific classes
                element.classList.remove('hidden');

                // Hide message after a few seconds
                setTimeout(() => {
                    element.classList.add('hidden');
                }, 3000);
            }

            /**
             * Renders the list of sent referrals.
             */
            function renderSentReferrals() {
                sentReferralsList.innerHTML = ''; // Clear existing list
                if (userReferrals.length === 0) {
                    const li = document.createElement('li');
                    li.className = 'text-gray-500';
                    li.textContent = 'No referrals sent yet. Start sharing!';
                    sentReferralsList.appendChild(li);
                } else {
                    userReferrals.forEach(referral => {
                        const li = document.createElement('li');
                        li.className = 'py-1';
                        li.textContent = `Referred ${referral.friendEmail} by ${referral.referrerName} on ${new Date(referral.timestamp).toLocaleDateString()}`;
                        sentReferralsList.appendChild(li);
                    });
                }
            }

            // --- Event Listeners ---

            // Initialize referral link display
            referralLinkInput.value = generateReferralLink();

            // Copy link button click
            copyLinkBtn.addEventListener('click', () => {
                copyToClipboard(referralLinkInput.value);
            });

            // Referral form submission
            referralForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission

                const referrerName = referrerNameInput.value.trim();
                const friendEmail = friendEmailInput.value.trim();

                if (!referrerName || !friendEmail) {
                    displayMessage(formMessage, 'Please fill in all fields.', 'error');
                    return;
                }

                // Basic email validation
                if (!/\S+@\S+\.\S+/.test(friendEmail)) {
                    displayMessage(formMessage, 'Please enter a valid email address.', 'error');
                    return;
                }

                // Simulate sending referral
                const newReferral = {
                    referrerName: referrerName,
                    friendEmail: friendEmail,
                    referralCode: userId, // The code used for this referral
                    timestamp: new Date().toISOString()
                };

                userReferrals.push(newReferral);
                localStorage.setItem('fitbonusReferrals', JSON.stringify(userReferrals));

                displayMessage(formMessage, 'Referral sent successfully! Thank you for sharing Fitbonus!', 'success');

                // Clear form
                referralForm.reset();
                renderSentReferrals(); // Update the list
            });

            // Initial render of sent referrals
            renderSentReferrals();
        });
    </script>
</body>

</html>
